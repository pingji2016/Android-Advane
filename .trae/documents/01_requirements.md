# 横屏闯关小游戏需求文档

## 1 项目概述
- **目标**：一款轻量级、横屏、离线可玩的平台闯关小游戏，安装包 ≤ 100 MB，支持在线增量更新关卡与资源。
- **资源策略**：优先复用开源美术与音效（Kenney、OpenGameArt），所有资源均注明作者与许可。
- **平台**：Android 8.0+，手机/平板，强制横屏。
- **商业模式**：免费、无内购、无广告，纯单机体验。

## 2 核心玩法
- 角色：左右移动、跳跃、二段跳（后期解锁）、基础攻击。
- 关卡：线性闯关，5–8 关首包内置；后续通过在线更新追加。
- 目标：到达终点或完成收集目标；评分维度：通关时间、收集率、死亡次数。
- 交互：虚拟按键（左/右/跳/攻）+ 可选手势；支持蓝牙手柄基础映射。

## 3 关卡系统
- 地图格式：Tiled 导出 JSON，瓦片尺寸 32×32 或 64×64。
- 层级：地形、装饰、交互、碰撞（单独层）。
- 难度曲线：新手→进阶→挑战；隐藏关卡可选。
- 通关解锁：前一关通过即可解锁下一关。

## 4 实体与 AI
- 主角：状态（Idle、Run、Jump、Attack、Hurt、Dead）。
- 敌人（3–4 种）：
  1. 巡逻型：固定路线往返。
  2. 追踪型：发现玩家后追击，丢失后返回。
  3. 远程型：投掷物抛物线。
  4. 陷阱型：静态伤害区域。
- 道具：金币、宝石、临时加速、护盾、回血。

## 5 UI/UX
- 主菜单：开始游戏、关卡选择、设置、关于。
- 设置：音量、操作方案、画质（低/中/高）、在线更新入口。
- 关卡内：暂停、重开、返回主菜单。
- 结算：星级评分、最佳记录、下一关按钮。

## 6 数据与存档
- 本地 JSON：
  - `save.json`：关卡进度、每关最佳评分。
  - `settings.json`：音量、画质、操作方案。
- 存档位于应用私有目录，支持原子写入与备份（`save.bak`）。

## 7 在线更新
- 资源清单 `manifest.json` 托管于远端 CDN，包含版本号、资源列表、SHA256、大小、下载地址。
- 触发时机：启动时（可选）、设置页手动检查。
- 流程：获取清单 → 差异计算 → 增量下载 → 校验 → 落地到 `filesDir/assets/<version>/` → 更新索引 → 重启游戏生效。
- 回滚：加载失败时自动回退到上一版本；保证离线可玩。

## 8 性能与质量
- 帧率：中端机 60 fps，低端机保底 30 fps。
- 渲染预算 ≤ 16 ms，逻辑预算 ≤ 4 ms。
- 资源按需加载，图集合并，音频压缩（OGG）。
- 冷启动 ≤ 2 s，关卡加载 ≤ 1 s。

## 9 安全与合规
- 资源哈希校验，防止篡改。
- 不采集隐私数据，无联网权限（仅更新时主动请求）。
- 开源资源注明许可与作者，放置“关于”页。

## 10 本地化与可访问性
- 语言：简体中文、English。
- 高对比度 UI 选项，按键尺寸可调。

## 11 里程碑
| 阶段 | 目标 |
|------|------|
| M1 | 可运行原型：角色移动跳跃 + 1 张测试关卡 |
| M2 | 完整关卡系统 + 5 关 + 存档 |
| M3 | 在线更新：清单、下载、校验、切换 |
| M4 | UI 打磨、音效、手柄支持、发布 |

## 12 风险与约束
- 多分辨率适配与输入兼容。
- 在线更新依赖 CDN 可用性与网络稳定性。
- 低端机性能瓶颈需持续 Profiling。